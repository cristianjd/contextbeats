<h1>Listing posts</h1>

<%= link_to 'New Post', new_post_path %><br />

<% @posts.each do |post| %>
    <%= render 'onepost', :post => post %>
    <p><%= link_to 'Show', post %> <%= link_to 'Edit', edit_post_path(post) %> <%= link_to 'Destroy', post, confirm: 'Are you sure?', method: :delete %></p>
    <br/>
<% end %>

<script>
    function IsNotBlank(field) {
        if ($(field).val() == "") {
            return false;
        } else if ($(field).val() != "") {
            return true;
        }
    }

    var post_div;

    $('.comment_link').click(function(event){
        event.preventDefault();
        post_div = '#' + $(this).parent().attr("id") + ' ';
        $(post_div + '.comment_container').slideToggle(600);
    });

    $(post_div + ".comment_submit").click(function(event){
        event.preventDefault();
        $(post_div +".errors_2").fadeOut(400, function(){
            if (!IsNotBlank("#comment_commenter")) {
                $(post_div +".errors_2").html("Name can not be blank.");
            }
            else if (!IsNotBlank("#comment_body")){
                $(post_div +".errors_2").html("Comment can not be blank.");
            }
            else {
                $(post_div +".errors_2").html("");
                $(post_div +".comment_form").submit(function(){
                    $(this).on("ajax:complete", function(){
                        $(post_div +".comment_body").val("");
                        $(post_div +".comment_commenter").val("");
                    });
                });
                $(post_div +".comment_form").submit();
            }
        });
        $(post_div +".errors_2").fadeIn(400);
    });

</script>